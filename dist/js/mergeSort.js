function initSort(){var e,r=0,t=new Array,n=new Array;for(str="",m=0;m<Names.length;m++)n[m]=m;for(m=0;m<Names.length;m++){for(p=Math.floor(Math.random()*Names.length);-1==n[p];)p=p>=Names.length-1?0:p+1;t[m]=n[p],n[p]=-1}lstMember[r]=new Array;for(var m=0;m<Members.length;m++)lstMember[r][m]=t[m];parent[r]=-1,totalSize=0,r++;for(var m=0;m<lstMember.length;m++)lstMember[m].length>=2&&(e=parseInt(lstMember[m].length/2),lstMember[r]=new Array,lstMember[r]=lstMember[m].slice(0,e),totalSize+=lstMember[r].length,parent[r]=m,r++,lstMember[r]=new Array,lstMember[r]=lstMember[m].slice(e,lstMember[m].length),totalSize+=lstMember[r].length,parent[r]=m,r++);for(m=0;m<Members.length;m++)rec[m]=0;for(nrec=0,m=0;m<=Members.length;m++)equal[m]=-1;cmp1=lstMember.length-2,cmp2=lstMember.length-1,head1=0,head2=0,numQuestion=1,finishSize=0,showTable()}function showTable(){var e=numQuestion+"回目</br>進行率"+Math.floor(100*finishSize/totalSize)+"%",r=""+toNameFace(lstMember[cmp1][head1]),t=""+toNameFace(lstMember[cmp2][head2]);document.getElementById("battleNumber").innerHTML=e,document.getElementById("leftCell").innerHTML=r,document.getElementById("rightCell").innerHTML=t,numQuestion++}function sortList(e){var r,t;if(0>e)for(document.getElementById("resultField").innerHTML=toNameFace0(Members[lstMember[cmp1][head1]].id),rec[nrec]=lstMember[cmp1][head1],head1++,nrec++,finishSize++;-1!=equal[rec[nrec-1]];)rec[nrec]=lstMember[cmp1][head1],head1++,nrec++,finishSize++;else if(e>0)for(document.getElementById("resultField").innerHTML=toNameFace0(Members[lstMember[cmp2][head2]].id),rec[nrec]=lstMember[cmp2][head2],head2++,nrec++,finishSize++;-1!=equal[rec[nrec-1]];)rec[nrec]=lstMember[cmp2][head2],head2++,nrec++,finishSize++;else{for(document.getElementById("resultField").innerHTML="引き分け",rec[nrec]=lstMember[cmp1][head1],head1++,nrec++,finishSize++;-1!=equal[rec[nrec-1]];)rec[nrec]=lstMember[cmp1][head1],head1++,nrec++,finishSize++;for(equal[rec[nrec-1]]=lstMember[cmp2][head2],rec[nrec]=lstMember[cmp2][head2],head2++,nrec++,finishSize++;-1!=equal[rec[nrec-1]];)rec[nrec]=lstMember[cmp2][head2],head2++,nrec++,finishSize++}if(head1<lstMember[cmp1].length&&head2==lstMember[cmp2].length)for(;head1<lstMember[cmp1].length;)rec[nrec]=lstMember[cmp1][head1],head1++,nrec++,finishSize++;else if(head2<lstMember[cmp2].length&&head1==lstMember[cmp1].length)for(;head2<lstMember[cmp2].length;)rec[nrec]=lstMember[cmp2][head2],head2++,nrec++,finishSize++;if(head1==lstMember[cmp1].length&&head2==lstMember[cmp2].length){for(r=0;r<lstMember[cmp1].length+lstMember[cmp2].length;r++)lstMember[parent[cmp1]][r]=rec[r];if(lstMember.pop(),lstMember.pop(),cmp1-=2,cmp2-=2,head1=0,head2=0,0==head1&&0==head2){for(r=0;r<Members.length;r++)rec[r]=0;nrec=0}}0>cmp1?(t=numQuestion-1+"回目</br>進行率"+Math.floor(100*finishSize/totalSize)+"%",document.getElementById("battleNumber").innerHTML=t,IsFinished=!0,calcScore(),showResult()):showTable()}function calcScore(){for(var e,r=3*(Members.length-1),t=0;t<Members.length;t++){if(e=0,t<Members.length-1)for(j=t;equal[lstMember[0][j]]==lstMember[0][j+1];j++)e++;if(Members[lstMember[0][t]].score=r-2*e,t<Members.length-1)for(j=t;equal[lstMember[0][j]]==lstMember[0][j+1];j++)t++,Members[lstMember[0][t]].score=r-2*e;r-=3*(e+1)}Members.sort(sortPerson);for(var n,t=0;t<Members.length;t++)for(n=t+1,Members[t].rank=n;t<Members.length-1&&Members[t].score==Members[t+1].score;)t++,Members[t].rank=n}function sortPerson(e,r){return e.score!=r.score?r.score-e.score:e.id-r.id}var lstMember=new Array,parent=new Array,equal=new Array,rec=new Array,cmp1,cmp2,head1,head2,nrec,numQuestion,totalSize,finishSize;